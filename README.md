# ربات فروشگاه کالای دیجیتال (fa/en) — پنل ادمین حرفه‌ای، پرداخت، ری‌اکشن متحرک 🎉

این پروژه یک ربات فروشگاهی کامل با محوریت **کالای دیجیتال** است (فایل/لایسنس). مهم‌ترین قابلیت‌ها:

- ✅ **پرداخت درون‌باتی** (Telegram Payments / `sendInvoice`)
- ✅ **اعلان به ادمین برای هر سفارش** (در یک پیام منسجم) + داشبورد
- ✅ **ری‌اکشن متحرک** روی پیام‌های وضعیت سفارش (🎉 با انیمیشن بزرگ)
- ✅ **پنل ادمین کامل**: سفارش‌ها (فیلتر/تغییر وضعیت/ارسال مجدد)، محصولات (اضافه/ویرایش/فعال‌/غیرفعال)، برادکست
- ✅ **ساختار ماژولار و تمیز** + هندلرهای جداگانه
- ✅ **تحویل خودکار کالای دیجیتال**: ارسال فایل (file_id) یا لایسنس (از pool)
- ✅ **ثبت دقیق زمان‌ها**: ایجاد/پرداخت/تحویل + تاریخچه‌ی وضعیت
- ✅ چندزبانه (fa/en) — *بدون هیچ اشاره‌ای به «پلن»*، فقط محصول
- ✅ پایگاه‌داده SQLite

> اگر می‌خواهید روی سورس موجودتان ادغام شود، می‌توانید ماژول‌ها را به پروژه‌ی خود منتقل کنید.

---

## راه‌اندازی

1) پیش‌نیازها
```bash
python >= 3.10
pip install -r requirements.txt
```

2) تنظیم محیط (فایل `.env` را از `.env.example` کپی و پر کنید)
- `BOT_TOKEN` و `ADMIN_IDS` الزامی
- برای اعلان واحد به ادمین‌ها می‌توانید `ADMIN_ALERT_CHAT_ID` را ست کنید (آی‌دی یک گروه/کانال/چت)

3) اجرا
```bash
python bot.py
```

> وب‌هوک: `USE_WEBHOOK=true` و `WEBHOOK_URL` را ست کنید.

---

## جریان خرید (Digital Goods)

- کاربر `/store` را می‌زند، لیست محصولات فعال را می‌بیند.
- با دکمهٔ «خرید»، **فاکتور** ارسال می‌شود (بدون آدرس/حمل).
- پس از پرداخت موفق، ربات **کالا را تحویل می‌دهد**: 
  - اگر نوع محصول «file» باشد، فایل (با `file_id`) ارسال می‌شود.
  - اگر نوع محصول «license» باشد، یک کد از pool آزاد شده برداشته و برای کاربر ارسال می‌شود.
- در هر تغییر وضعیت (ایجاد/پرداخت/تحویل/لغو/عودت)، پیام وضعیت به کاربر ارسال و روی همان پیام **ری‌اکشن 🎉 با انیمیشن بزرگ** ست می‌شود.
- به ادمین هم یک اعلان واحد (خلاصه و شفاف) ارسال می‌گردد.

---

## دستورات

- کاربر: `/start`, `/help`, `/store`, `/orders`
- ادمین: `/admin`, `/stats`, `/broadcast`
  - پنل ادمین کاملاً اینلاین: **Dashboard / Orders / Products / Settings**

---

## نکات مهم

- برای **ری‌اکشن متحرک** از متد `setMessageReaction` با `is_big=True` استفاده شده است. روی اکثر کلاینت‌ها برای ایموجی 🎉 انیمیشن نمایشی انجام می‌شود.
- برای **Message Effects (message_effect_id)** نیز hook پیش‌بینی شده، اما نیازمند شناسهٔ effect است. (اختیاری)
- این پروژه فقط «محصول» را پوشش می‌دهد و **هیچ متنی دربارهٔ پلن/اشتراک** ندارد.
